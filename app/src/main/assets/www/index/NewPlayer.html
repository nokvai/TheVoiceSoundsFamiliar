<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<script src='../js/jquery-3.2.1.js' type='text/javascript'></script>-->
    <!--<script src='../js/musicHelper.js' type='text/javascript'></script>-->
    <!--<script src='../js/clickSound.js' type='text/javascript'></script>-->
    <!--<link href="../css/CustomStyles.css" rel="stylesheet" type="text/css" >-->

	<script src='file:///android_asset/www/js/jquery-3.2.1.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/musicHelper.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/clickSound.js' type='text/javascript'></script>
	<link href="file:///android_asset/www/css/CustomStyles.css" rel="stylesheet" type="text/css" >
	<script>
        $(document).ready(function() {

       		 function showTheme() {
                $("body").css({"background-image": "url(" + mygame.getChangeTheme(Number(1)) + ")"});
                $("body").addClass("bg");
             } showTheme();

        	var tbl = $('#tableNewPlayer tbody');
        	var id = "";

            $("#btnBack").click(function() {
                clickSound();
                setTimeout(function() {
                    window.location = "../index/ChoosePlayer.html";
                }, 400);
            });

			$("#btnAdd").click(function() {
                clickSound();
                var name = $("#textBoxPlayerName").val();
				var gender = $("#selectGender").find(":selected").text();
                if (name.length > 15) {
					mygame.msg('Name should not be longer than 15 characters.');
                } else if (name.length <= 15 ) {

					var players = mygame.getAllPlayer().split(',');
					var hasExist = false;
					for (var i=0;i< (players.length - 1);i++) {
						var p = players[i].split('&');
						if (p[1].toLowerCase() == name.toLowerCase()) {
							hasExist = true;
						}
					}

					if (hasExist) {
						mygame.msg('You entered an existing player name. \nplease try again.');
					} else {
						 var r = confirm("Are you sure you want to add this player?");
						if (r == true) {
							mygame.addPlayer(name,gender, Number("50"));
							LoadPlayers();
							$("#textBoxPlayerName").val("");
						} else {}
					}
                }
            });

			$("#btnUpdate").click(function() {
                clickSound();
   				if (id != "") {
   				 	var name = $("#textBoxPlayerName").val();
                    var gender = $("#selectGender").find(":selected").text();

					if (name.length > 15) {
						mygame.msg('Name should not be longer than 15 characters.');
					} else if (name.length <= 15 ) {

						var players = mygame.getAllPlayer().split(',');
						var hasExist = false;
						for (var i=0;i< (players.length - 1);i++) {
							var p = players[i].split('&');
							if (p[1].toLowerCase() == name.toLowerCase()) {
								hasExist = true;
							}
						}

						if (hasExist) {
							mygame.msg('You entered an existing player name. \nplease try again.');
						} else {
							var r = confirm("Apply this changes?");
							if (r == true) {
								mygame.updatePlayerNameGender(Number(id), name, gender);
								LoadPlayers();
							} else {}
						}
					}

                } else {
					mygame.msg("Select a player.");
                }
              	LoadPlayers();
            });

			$("#btnDelete").click(function() {
                clickSound();

                if (id != "") {
                	var r = confirm("Are you sure you want to remove player?");
					if (r == true) {
						mygame.deletePlayer(Number(id));
						mygame.deleteSong(Number(id));
						LoadPlayers();

					} else {}
                } else {
					mygame.msg("Select a player.");
                }
            });


			function LoadPlayers() {
				tbl.empty();
				var players = mygame.getAllPlayer().split(',');
				for (var i=0;i< (players.length - 1);i++) {
					var p = players[i].split('&');
					var tr = $('<tr/>');
					//var td0 = $('<td/>');
					var td1 = $('<td/>');
					var td2 = $('<td/>');
					//var td3 = $('<td/>');
					tr.attr("id", p[0]);
					//td0.append(p[0]); // id
					td1.append(p[1]); // playername
					td2.append(p[2]); // gender
					//td3.append(p[3]); // finalscore
					//tr.append(td0);
					tr.append(td1);
					tr.append(td2);
					//tr.append(td3);
					tbl.append(tr);
				}
			}
			LoadPlayers();

			 $('#tableNewPlayer tbody').on( 'click', 'tr', function () {
				if ( $(this).hasClass('selected') ) {
					$(this).removeClass('selected');
				}
				else {
					$(this).siblings().removeClass('selected');
					$(this).addClass('selected');

						id = $("#tableNewPlayer tbody tr.selected").attr("id");
						var name = $("#tableNewPlayer tbody tr.selected td")[0].textContent;
						var gender = $("#tableNewPlayer tbody tr.selected td")[1].textContent;
						$("#textBoxPlayerName").val(name);
						$("#selectGender").val(gender);

				}
			});



        });


    </script>

</head>

<body>
    <h2 id="title" style="text-align:center;">Create Player / Update / Delete</h2>
	<div class="center-div">
		<div style="width: 60%; float: left; margin-left: 10px;">
			<table border="1" class="table-center" id="tableNewPlayer">
				<thead>
				<tr>
					<!--<th>id</th>-->
					<th>Player Name</th>
					<th>Gender</th>
					<!--<th>Score</th>-->
				</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
		<div style="width: 80%; float: right; margin-right: 5px; margin-top: 20px;">
			<label>Player Name: </label>
			<input type="text" id="textBoxPlayerName" placeholder="Max of 15 characters" />
			<br><br>
			<label>Gender: </label>
			<select id="selectGender">
				<option>Male</option>
				<option>Female</option>
			</select>

			<br><br>
			<button id="btnAdd" class="button-nav" style="width:90px;">Add</button>
			&nbsp;
			<button id="btnUpdate" class="button-nav" style="width:90px;">Update</button>
			&nbsp;
			<button id="btnDelete" class="button-nav" style="width:90px;">Delete</button>

			<div class="center-div" style="text-align:center; margin-top: 25px;">
				<button id="btnBack" class="button-nav" style="width:150px;">Back</button>
				<!--&nbsp;&nbsp;&nbsp;&nbsp;-->
			</div>
		</div>
	</div>
	<br>

</body>

</html>
