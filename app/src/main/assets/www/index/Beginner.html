<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<script src='../js/jquery-3.2.1.js' type='text/javascript'></script>-->
    <!--<script src='../js/musicHelper.js' type='text/javascript'></script>-->
    <!--<script src='../js/clickSound.js' type='text/javascript'></script>-->
    <!--<link href="../css/CustomStyles.css" rel="stylesheet" type="text/css" >-->
	<script src='file:///android_asset/www/js/jquery-3.2.1.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/musicHelper.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/clickSound.js' type='text/javascript'></script>
	<link href="file:///android_asset/www/css/CustomStyles.css" rel="stylesheet" type="text/css" >
    <script>
        $(document).ready(function() {

			function showTheme() {
                $("body").css( {"background-image": "url(" + mygame.getChangeTheme(Number(1)) + ")"});
                $("body").addClass("bg");
             } showTheme();

			$("#finishedLevel").hide();
			var player_id = "";
			var question_no = "";
			var level = "";
			var UsedHint = 0;
			var usedH1 = 0;
			var usedH2 = 0;
			var usedH3 = 0;
			var downloadTimer;
			var deleteSong = "";
			var song = "";

			function setValue(level, id) {
				var queryString = "?level=" + level + "&id=" + id;
				window.location.href = "file:///android_asset/www/index/Level30.html" + queryString;
			}

			function setValue20(level, id) {
				var queryString = "?level=" + level + "&id=" + id;
				window.location.href = "file:///android_asset/www/index/Level20.html" + queryString;
			}

			function getValue() {
				var queryString = decodeURIComponent(window.location.search);
					queryString = queryString.substring(1);
					var queries = queryString.split("&");
					var result = [];
					for (var i = 0; i < queries.length; i++) {
					  result.push( queries[i].split("=") );
					}
				return result;
			}

			question_no = getValue()[0][1];
			player_id = getValue()[1][1];
			level = getValue()[2][1];

			var player = mygame.getPlayer(Number(player_id)).split(',');
			$("#questionNo").text( parseInt(question_no) + 1 );
			$("#playerName").text(player[1]);

			if (Number(question_no) != 60) {

				song = mygame.getSongByIdLevelIndex(Number(player_id), level, Number(question_no)).split(',');
				//alert(song[1]);
				var fourSongs = mygame.getBeginnerSongChoices(song[1]).split(',');
				var answer1 = fourSongs[0].split('-')[0].split('_').join(' ');
				var answer2 = fourSongs[1].split('-')[0].split('_').join(' ');
				var answer3 = fourSongs[2].split('-')[0].split('_').join(' ');
				var answer4 = fourSongs[3].split('-')[0].split('_').join(' ');

				$("#letterA").text("A. " + answer1);
				$("#letterB").text("B. " + answer2);
				$("#letterC").text("C. " + answer3);
				$("#letterD").text("D. " + answer4);
			}

			$(".select-question b").click(function(){
				$(this).addClass("selected").siblings().removeClass("selected");
				$(this).attr("style", "color: #FFA500 !important;").siblings().removeAttr("style");
			});

			function Hint1Everytime() {
				if ( usedH1 == 1) {
					if ($("#letterA").text().substring(3) == deleteSong) { $("#letterA").css({"display": "none"}); }
					else if ($("#letterB").text().substring(3) == deleteSong) { $("#letterB").css({"display": "none"}); }
					else if ($("#letterC").text().substring(3) == deleteSong) { $("#letterC").css({"display": "none"}); }
					else if ($("#letterD").text().substring(3) == deleteSong) { $("#letterD").css({"display": "none"}); }
				}
			}

			function hint1() {
				var correctAnswer = song[1].split('-')[0].split('_').join(' ');

				if (correctAnswer == answer1) {
					deleteSong = mygame.getBeginnerHintRemoveAnswer(answer2, answer3, answer4);
				} else if (correctAnswer == answer2) {
					deleteSong = mygame.getBeginnerHintRemoveAnswer(answer1, answer3, answer4);
				} else if (correctAnswer == answer3) {
					deleteSong = mygame.getBeginnerHintRemoveAnswer(answer1, answer2, answer4);
				} else if (correctAnswer == answer4) {
					deleteSong = mygame.getBeginnerHintRemoveAnswer(answer1, answer2, answer3);
				}
				usedH1 = 1;
				Hint1Everytime();
			}

			function hint2() {
				clearInterval(downloadTimer);
				Play(15);
				usedH2 = 1;
			}

			function hint3() {
				var correctAnswer = song[1].split('-')[0].split('_').join(' ');
				$("#btnHint3").text("Given letter: " + mygame.getBeginnerHintGiveOneLetter(correctAnswer) );
				usedH3 = 1;
			}

			function disableHint() {
				var songs = mygame.getFinishedSongsByIdLevelIndex(Number(player_id), level).split(',');
				var cnt_hint = 0;
				for(var z=0;z < (songs.length - 1); z++ ) {
					var s = songs[z].split('&');
					var index = (Number(s[2]) + 1);
					if (Number(s[5]) > 0) {
						cnt_hint++;
					}
					var h = Number(s[5]);
					if (h == 1) { $("#btnHint1").css({"display": "none"}); }
					else if (h == 2) { $("#btnHint2").css({"display": "none"}); }
					else if (h == 3) { $("#btnHint3").css({"display": "none"}); }
					else if (h == 12) { $("#btnHint1").css({"display": "none"}); $("#btnHint2").css({"display": "none"});  }
					else if (h == 13) { $("#btnHint1").css({"display": "none"}); $("#btnHint3").css({"display": "none"});  }
					else if (h == 21) { $("#btnHint2").css({"display": "none"}); $("#btnHint1").css({"display": "none"});  }
					else if (h == 23) { $("#btnHint2").css({"display": "none"}); $("#btnHint3").css({"display": "none"});  }
					else if (h == 31) { $("#btnHint3").css({"display": "none"}); $("#btnHint1").css({"display": "none"});  }
					else if (h == 32) { $("#btnHint3").css({"display": "none"}); $("#btnHint2").css({"display": "none"});  }
					else if (h == 123) { $("#btnHint1").css({"display": "none"}); $("#btnHint2").css({"display": "none"});  $("#btnHint3").css({"display": "none"}); }
				}
			}

			function showPoints() {
					var songs = mygame.getFinishedSongsByIdLevelIndex(Number(player_id), level).split(',');
					var score = 0;
					var cnt_wrong = 0;
					var cnt_hint = 0;
					var hint_subtract = 0;
					for(var z=0;z < (songs.length - 1); z++ ) {
						var s = songs[z].split('&');
						var index = (Number(s[2]) + 1);
						if (Number(s[5]) > 0) {
							cnt_hint++;
						}
						if (Number(s[6]) == 0) {
							cnt_wrong++;
						}
						score += Number(s[6]);
					}
					if( cnt_hint == 1 ) { hint_subtract = 40; }
					else if( cnt_hint == 2 ) { hint_subtract = 80; }
					else if( cnt_hint == 3 ) { hint_subtract = 120; }
					score = Number(score);
					var player = mygame.getPlayer(Number(player_id)).split(',');
					var playerScore = Number(player[3]);
					var total = ( (playerScore + score) - hint_subtract );
					$("body div").hide();
					$("#finishedLevel").show();
					$("#initialPoints").text("Initial Points: " + playerScore);
					$("#earnedPoints").text("Earned Points: " + score);
					$("#wrongAnswers").text("Wrong Answers: " + cnt_wrong);
					$("#deductions").text("Deducted Points: " + hint_subtract);
					$("#finalScore").text("Total Points: " + total);
					$("#btnBack").show();
			}

			function getSelectedAnswer() {
				$(".select-question").find("b.selected").each(function(index, elem) {
					if($(this).length > 0) {
						var correctAnswer = song[1].split('-')[0].split('_').join(' ');
						var selectedAnswer = $(this).text().substring(3);
						if (usedH1 > 0) { UsedHint = 1; }
						else if (usedH2 > 0) { UsedHint = 2; }
						else if (usedH3 > 0) { UsedHint = 3; }
						else if ( (usedH1 > 0) && (usedH2 > 0) ) { UsedHint = 12; }
						else if ( (usedH1 > 0) && (usedH3 > 0) ) { UsedHint = 13; }
						else if ( (usedH2 > 0) && (usedH1 > 0) ) { UsedHint = 21; }
						else if ( (usedH2 > 0) && (usedH3 > 0) ) { UsedHint = 23; }
						else if ( (usedH3 > 0) && (usedH1 > 0) ) { UsedHint = 31; }
						else if ( (usedH3 > 0) && (usedH2 > 0) ) { UsedHint = 32; }
						else if ( (usedH1 > 0) && (usedH2 > 0) && (usedH2 > 0)) { UsedHint = 123; }
						if ( selectedAnswer == correctAnswer ) {
							mygame.updateSongByIdLevelIndex(Number(player_id), level, Number(question_no), Number("1"), UsedHint, Number("5"), Number("1"));
						} else {
							mygame.updateSongByIdLevelIndex(Number(player_id), level, Number(question_no), Number("0"), UsedHint, Number("0"), Number("1"));
						}

						var songs = mygame.getFinishedSongsByIdLevelIndex(Number(player_id), level).split(',');

						var dbsongs = mygame.getSongs(Number(player_id), level).split(',');
					    var dblength = (dbsongs.length - 1);
						if (dblength == 30) {
							if( Number(songs.length - 1) < 30 ) {
								setTimeout(function() {
									setValue(level, player_id);
								}, 400);
							} else if ( Number(songs.length - 1) == 30 ) {
								showPoints();
							}
						}
						else if (dblength == 50) {
							if( Number(songs.length - 1) < 50 ) {
								setTimeout(function() {
									setValue20(level, player_id);
								}, 400);
							} else if ( Number(songs.length - 1) == 50 ) {
								showPoints();
							}
					    }

					} else if ( $(this).length == 0 ) {
						mygame.msg("Select an answer.");
					}
				});
			}

			function checkEnableHint() {
				var songs = mygame.getFinishedSongsByIdLevelIndex(Number(player_id), level).split(',');
				var score = 0;
				var cnt_wrong = 0;
				var cnt_hint = 0;
				var hint_subtract = 0;
				for(var z=0;z < (songs.length - 1); z++ ) {
					var s = songs[z].split('&');
					var index = (Number(s[2]) + 1);
					if (Number(s[5]) > 0) {
						cnt_hint++;
					}
					if (Number(s[6]) == 0) {
						cnt_wrong++;
					}
					score += Number(s[6]);
				}
				if( cnt_hint == 1 ) { hint_subtract = 40; }
				else if( cnt_hint == 2 ) { hint_subtract = 80; }
				else if( cnt_hint == 3 ) { hint_subtract = 120; }

				score = ( Number(score) - Number(hint_subtract) );
				var player = mygame.getPlayer(Number(player_id)).split(',');
				var playerScore = Number(player[3]);
				var total = ( (playerScore + score) - hint_subtract );

				if (total < 40) {

					$("#btnHint").hide();
				} else if (total >= 40) {

					$("#btnHint").show();
				}
			}

			function Play(sec) {
				var timeleft = sec;
				 downloadTimer = setInterval(function() {
					$("#secondsLeft").text("Seconds Left: " + timeleft);
					$("#progressBarSeconds").val( timeleft );
					if (timeleft >= sec) {
						$("#progressBarSeconds").css({"display": "inline"});
						playBeginnerMusic(song[1]);
					} else if (timeleft == 0) {
						$("#progressBarSeconds").css({"display": "none"});
						stopAudio();
					}
					--timeleft;
					if(timeleft < 0)
					clearInterval(downloadTimer); },1000);
			}

			$("#btnBack").click(function() {
                clickSound();
                setTimeout(function() {
                    setValue(level, player_id);
                }, 400);
            });

			$("#btnSubmit").click(function() {
                clickSound();
				getSelectedAnswer();
            });

			$("#btnHint").click(function() {
				if ($("#hintBox").hasClass('hide-hint') ) {
					$("#hintBox").removeClass('hide-hint');
					$("#hintBox").addClass('show-hint');
				} else {
					$("#hintBox").removeClass('show-hint');
					$("#hintBox").addClass('hide-hint');
				}
            });

			$("#btnHint1").click (function() {
				hint1();
				$("#btnHint1").css({"display": "none"});
				$("#hintBox").addClass('hide-hint');
			});
			$("#btnHint2").click (function() {
				hint2();
				$("#btnHint2").css({"display": "none"});
				$("#hintBox").addClass('hide-hint');
			});
			$("#btnHint3").click (function() {
				hint3();
				setTimeout(function() {
                	$("#btnHint3").css({"display": "none"});
					$("#hintBox").addClass('hide-hint');
                }, 5000);
			});

			$("#btnFinish").click(function() {
				setTimeout(function() {
					setValue(level, player_id);
				}, 400);
			});

			$("#letterA").click(function() { Hint1Everytime(); $("#btnSubmit").show(); });
			$("#letterB").click(function() { Hint1Everytime(); $("#btnSubmit").show(); });
			$("#letterC").click(function() { Hint1Everytime(); $("#btnSubmit").show(); });
			$("#letterD").click(function() { Hint1Everytime(); $("#btnSubmit").show(); });


			disableHint();
			checkEnableHint();
			Play(20);

			if (Number(question_no) == 60) {  stopAudio();  showPoints();  }
		});

    </script>
</head>

<body>
	<div class="circle-text" style="float: left; margin-left: 10px; margin-top: 10px;">
		<b id="questionNo" style="position: relative; top: 20px;">1</b>
	</div>

	<img style="position: absolute; top: 10px; left: 110px; height: 80px;" src="../image/ic_launcher.png" />

	<div class="rectangle-text" style="float: right; margin-right: 10px; margin-top: 15px;">
		<b id="secondsLeft" style="position: relative; top:15px;">Seconds Left: 0</b>
		<progress id="progressBarSeconds" style="position: relative; margin-top: 40px;" value="20" max="20" ></progress>
	</div>
	
	<div class="rectangle-text" style="float: right; margin-right: 5px; margin-top: 15px;">
		<b id="playerName" style="position: relative; top:15px;"></b>
	</div>

	<div id="finishedLevel" style="text-align: center; position: relative; top: 90px; display: none;">
		<h1 style="text-align:center; color: orange; ">Beginner level Completed!!!</h1>

		<h2 style="color: blue; font-family: 'Lucida Console', Times, serif; font-weight: bold; font-size: 20px;" id="initialPoints">Initial Points: </h2>
		<h2 style="color: green; font-family: 'Lucida Console', Times, serif; font-weight: bold; font-size: 20px;" id="earnedPoints">Earned Points: </h2>
		<h2 style="color: red; font-family: 'Lucida Console', Times, serif; font-weight: bold; font-size: 20px;" id="wrongAnswers">Wrong Answers: </h2>
		<h2 style="color: violet; font-family: 'Lucida Console', Times, serif; font-weight: bold; font-size: 20px;" id="deductions">Deducted Points: </h2>
		<h2 style="font-family: 'Lucida Console', Times, serif; font-weight: bold; font-size: 18px;" id="finalScore">Total Points: </h2>
		<button id="btnFinish" class="button-nav">Finish</button>
	</div>

	<div class="select-question" style="text-align: left; position: absolute; top: 32%; left: 10%;">
		<b id="letterA" class="question-text"></b><br><br>
		<b id="letterB" class="question-text"></b><br><br>
		<b id="letterC" class="question-text"></b><br><br>
		<b id="letterD" class="question-text"></b><br>
    </div>
	<div id="hintBox" class="hide-hint" style="position: absolute; top: 32%; left: 40%; width: 320px; height: 150px; border-radius: 12px; background-color: #0074d9;">
		<button id="btnHint1" class="button-hint">remove a letter from the given choices</button>
		<button id="btnHint2" class="button-hint">play music again in 15 seconds</button>
		<button id="btnHint3" class="button-hint">give one letter of the song title</button>
	</div>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<div class="center-div">
		<button id="btnBack"  class="button-nav" style="display: none;">Back</button> &nbsp;&nbsp;&nbsp;
		<button id="btnSubmit"  class="button-nav" style="display: none;">Submit</button>&nbsp;&nbsp;
		<button id="btnHint"  class="button-nav">Hint</button>&nbsp;&nbsp;&nbsp;
	</div>
</body>
</html>
