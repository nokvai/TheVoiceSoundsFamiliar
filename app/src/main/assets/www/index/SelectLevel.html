<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<script src='../js/jquery-3.2.1.js' type='text/javascript'></script>-->
    <!--<script src='../js/musicHelper.js' type='text/javascript'></script>-->
    <!--<script src='../js/clickSound.js' type='text/javascript'></script>-->
    <!--<link href="../css/CustomStyles.css" rel="stylesheet" type="text/css" >-->

	<script src='file:///android_asset/www/js/jquery-3.2.1.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/musicHelper.js' type='text/javascript'></script>
	<script src='file:///android_asset/www/js/clickSound.js' type='text/javascript'></script>
	<link href="file:///android_asset/www/css/CustomStyles.css" rel="stylesheet" type="text/css" >
    <script>
        $(document).ready(function() {
		
			 function showTheme() {
                $("body").css({"background-image": "url(" + mygame.getChangeTheme(Number(1)) + ")"});
                $("body").addClass("bg");
             } showTheme();

			function setValue(level, id) {
				var queryString = "?level=" + level + "&id=" + id;
				window.location.href = "file:///android_asset/www/index/Level30.html" + queryString;
			}
			
			function getValue() {
				var queryString = decodeURIComponent(window.location.search);
					queryString = queryString.substring(1);
					var queries = queryString.split("&");
					var result = []; 
					for (var i = 0; i < queries.length; i++) {
					  result.push( queries[i].split("=") );
					}
				return result;
			}
		
            $("#btnBack").click(function() {
                clickSound();
                setTimeout(function() {
                    window.location = "file:///android_asset/www/index/ChoosePlayer.html";
                }, 400);
            });
			
			$("#btnBeginner").click(function() {
				clickSound();
				setTimeout(function() {
					var id = getValue()[0][1];
					setValue("b", id);
				}, 400);
            });
			
			$("#btnAdvance").click(function() {
				clickSound();
				setTimeout(function() {
					var id = getValue()[0][1];
					setValue("a", id);
				}, 400);
            });
			
			$("#btnExpert").click(function() {
				clickSound();
				setTimeout(function() {
					var id = getValue()[0][1];
					setValue("e", id);
				}, 400);
            });


			$("#btnAdvance").hide();
			$("#btnExpert").hide();

			function checkScoreOnLevel(player_id, level) {
					var songs = mygame.getFinishedSongsByIdLevelIndex(Number(player_id), level).split(',');
					var score = 0;
					var cnt_wrong = 0;
					var cnt_hint = 0;
					var hint_subtract = 0;
					for(var z=0;z < (songs.length - 1); z++ ) {
						var s = songs[z].split('&');
						var index = (Number(s[2]) + 1);
						if (Number(s[5]) > 0) {
							cnt_hint++;
						}
						if (Number(s[6]) == 0) {
							cnt_wrong++;
						}
						score += Number(s[6]);
					}
					if( cnt_hint == 1 ) { hint_subtract = 40; }
					else if( cnt_hint == 2 ) { hint_subtract = 80; }
					else if( cnt_hint == 3 ) { hint_subtract = 120; }
					score = Number(score);
					var player = mygame.getPlayer(Number(player_id)).split(',');
					var playerScore = Number(player[3]);
					return Number( (playerScore + score) - hint_subtract );
			}

			var your_id = getValue()[0][1];

			var beginner_score = checkScoreOnLevel(your_id, "b");
			var advance_score = checkScoreOnLevel(your_id, "a");

			if (Number(beginner_score) >= 80) {
				$("#btnAdvance").show();
			}
			if (Number(advance_score) >= 100) {
				$("#btnExpert").show();
			}

        });


    </script>

</head>

<body>
    <h2 id="title" style="text-align:center;">Select Level</h2>
    <div style="text-align:center;">
		<button id="btnBeginner" class="button-nav">Beginner Millennial</button>
		<br>
		<button id="btnAdvance" class="button-nav" style="position: relative; top: 10px;">Advance 1990’s</button>
		<br>
		<button id="btnExpert" class="button-nav" style="position: relative; top: 20px;">Expert 1970’s</button>
		<br>
		<button id="btnBack" class="button-nav" style="position: relative; top: 30px;">Back</button>
    </div>
	
</body>

</html>
